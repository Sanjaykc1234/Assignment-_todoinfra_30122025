name: "infra app"

trigger: none

pool:
  name: vinod

steps:
# ðŸ”¹ Install Terraform (REQUIRED for self-hosted agent)
- task: TerraformInstaller@1
  displayName: Install Terraform
  inputs:
    terraformVersion: '1.10.5'

# ðŸ”¹ Terraform Init
- task: TerraformTask@5
  displayName: Terraform init
  inputs:
    provider: 'azurerm'
    command: 'init'
    workingDirectory: '$(System.DefaultWorkingDirectory)/environment/dev'
    backendServiceArm: 'vinod service connection'
    backendAzureRmResourceGroupName: 'rg-rohit'
    backendAzureRmStorageAccountName: 'stgrohit'
    backendAzureRmContainerName: 'container-rohit'
    backendAzureRmKey: 'rohit.tfstate'

# ðŸ”¹ Terraform Validate
- task: TerraformTask@5
  displayName: Terraform validate
  inputs:
    provider: 'azurerm'
    command: 'validate'
    workingDirectory: '$(System.DefaultWorkingDirectory)/environment/dev'

# ðŸ”¹ Terraform Plan
- task: TerraformTask@5
  displayName: Terraform plan
  inputs:
    provider: 'azurerm'
    command: 'plan'
    workingDirectory: '$(System.DefaultWorkingDirectory)/environment/dev'
    environmentServiceNameAzureRM: 'vinod service connection'
